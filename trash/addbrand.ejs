<form id="filterForm" method="GET" action="/admin/sale-report" class="dd_control_bar">
    <select name="range" id="dateFilter" class="dd_time_filter">
        <option value="">Select Range</option>
        <option value="1" <%=range==1 ? "selected" : "" %>>Last Day</option>
        <option value="7" <%=range==7 ? "selected" : "" %>>Last 7 Days</option>
        <option value="30" <%=range==30 ? "selected" : "" %>>Last 30 Days</option>
        <option value="custom" <%=start && end ? "selected" : "" %>>Custom Range</option>
    </select>

    <input type="date" name="start" id="startDate" class="form-control" style="width:20% !important;"
        value="<%= start || '' %>" />
    <input type="date" name="end" id="endDate" class="form-control" style="width:20% !important;"
        value="<%= end || '' %>" />

    <button type="submit" class="btn btn-primary">Apply</button>
    <button type="button" id="clearFilter" class="btn btn-secondary">Clear Filter</button>

    <div class="dd_action_buttons">
        <a href="/admin/download/pdf" id="downloadPdf" class="dd_download_pdf">
            <i class="fas fa-file-pdf"></i> Download PDF
        </a>
        <a href="#" id="downloadExcel" class="dd_download_excel">
            <i class="fas fa-file-excel"></i> Download Excel
        </a>
    </div>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dateFilter = document.getElementById('dateFilter');
        const startDate = document.getElementById('startDate');
        const endDate = document.getElementById('endDate');
        const downloadPdf = document.getElementById('downloadPdf');
        const downloadExcel = document.getElementById('downloadExcel');
        const clearFilter = document.getElementById('clearFilter');
        
        // Show/hide date inputs based on dropdown selection
        dateFilter.addEventListener('change', function() {
            if (this.value === 'custom') {
                startDate.style.display = 'inline-block';
                endDate.style.display = 'inline-block';
            } else {
                startDate.style.display = this.value === '' ? 'inline-block' : 'none';
                endDate.style.display = this.value === '' ? 'inline-block' : 'none';
            }
        });
        
        // Initialize display state
        if (dateFilter.value === 'custom' || dateFilter.value === '') {
            startDate.style.display = 'inline-block';
            endDate.style.display = 'inline-block';
        } else {
            startDate.style.display = 'none';
            endDate.style.display = 'none';
        }
        
        // Update download links with current filter parameters
        function updateDownloadLinks() {
            const params = new URLSearchParams();
            
            if (dateFilter.value) {
                if (dateFilter.value === 'custom') {
                    if (startDate.value) params.append('start', startDate.value);
                    if (endDate.value) params.append('end', endDate.value);
                } else {
                    params.append('range', dateFilter.value);
                }
            }
            
            const queryString = params.toString();
            downloadPdf.href = `/admin/download/pdf${queryString ? '?' + queryString : ''}`;
            downloadExcel.href = `/admin/download/excel${queryString ? '?' + queryString : ''}`;
        }
        
        // Update download links when form values change
        dateFilter.addEventListener('change', updateDownloadLinks);
        startDate.addEventListener('change', updateDownloadLinks);
        endDate.addEventListener('change', updateDownloadLinks);
        
        // Initialize download links
        updateDownloadLinks();
        
        // Excel download handler
        downloadExcel.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = this.href;
        });
        
        // Clear filter button
        clearFilter.addEventListener('click', function() {
            dateFilter.value = '';
            startDate.value = '';
            endDate.value = '';
            startDate.style.display = 'inline-block';
            endDate.style.display = 'inline-block';
            updateDownloadLinks();
        });
    });
</script>